## ConcurrentHashMap

ConcurrentHashMap是Java 5中支持高并发、高吞吐量的线程安全HashMap实现。

它由Segment数组结构和HashEntry数组结构组成。

Segment在ConcurrentHashMap里扮演锁的角色，HashEntry则用于存储键值对数据。

一个ConcurrentHashMap里包含一个Segment数组，Segment的结构和HashMap类似，是一种数组和链表结构。

一个Segment里包含一个HashEntry数组，每个HashEntry是一个链表结构的元素，每个Segment守护着一个HashEntry数组里的元素，当对HashEntry数组的数据进行修改时，首先必须获得它对应的Segment锁。

Hashtable和ConcurrentHashMap存储的内容为键值对（key-value），且它们都是线程安全的容器

ConcurrentHashMap将Hash表默认分为16个桶（每一个桶可以被看作是一个Hashtable），大部分操作都没有用到锁，而对应的put、remove等操作也只需要锁住当前线程需要用到的桶，而不需要锁住整个数据。采用这种设计方式以后，在大并发的情况下，同时可以有16个线程来访问数据。显然，大大提高了并发性。

只有个别方法（例如：size()方法和containsValue()方法）可能需要锁定整个表而不仅仅是某个桶，在实现的时候，需要按顺序锁定所有桶，操作完毕后，又“按顺序”释放所有桶，“按顺序”的好处是能防止死锁的发生。

