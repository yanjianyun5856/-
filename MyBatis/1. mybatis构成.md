###  mybatis构成

1. SqlSessionFactoryBuilder构造器, 根据配置信息生成 工厂接口
2. SqlSessionFactory工厂接口，生成SqlSession 
3. SqlSession 发送SQL去执行并返回结果；获取Mapper接口
4. SqlMapper由一个java 接口 和 xml文件（或注解）构成，  需要给出对应的SQL和映射规则



####  构建SqlSessionFactory

Configuration   全名  org.apache.ibatis.session.Configuration
Configuration类对象保存着我们配置的 MyBatis 信息
SqlSessionFactory 的实现类 DefaultSqlSessionFactory(常用) 和 SqlSessionMapper 

#####  xml方式构建

xml文件中包含:

1. 获取数据库连接实例的数据源 DataSource
2. 决定事务范围和控制方式 的事务管理器 TransactionManager
3. 映射器 SQL Mapper

mybatis-config.xml文件

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- 定义数据库信息，默认使用 development 数据库构建环境 -->
    <environments default="development">
		<environment id="development">
			<!-- 采用JDBC事务管理  -->
			<transactionManager type="JDBC" >
			<!-- 配置数据库连接信息 -->
			<dataSource type="POOLED">
				<property name="driver" value="com.mysql.jdbc.Driver">
				<property name="jdbc" value="jdbc:mysql://localhost:3306/mybatis">
				<property name="username" value="root">
				<property name="password" value="111111">
			</dataSource>
		</environment>
	</environments>
	<!-- 定义映射器 -->
	<mappers>
		<mapper source="/mapper/*Mapper.xml" >
	</mappers>
</configuration>
```



##### 创建 SqlSessionFactory

```java
String source = "mybatis-config.xml";
InputStream inputStream = Resource.gerResourceAsStream(source);
SqlSessionFactory sqlSessionFactory =
	new SqlSessionFactoryBuilder().build(inputStream);
```



####  创建SqlSession

SqlSession 接口的实现类 DefaultSqlSession
SqlSession 是一个接口类 ，扮演门面的作用，真正干活的是 Executor 接口 

```java
SqlSession sqlSession = sqlSessionFactory.openSession();
// ...
sqlSession.commit();
sqlSession.close();

```

#####  SqlSession 的主要用途

1. 获取映射器，让映射器通过命名空间和方法名找到对应的SQL，发送给数据库执行后返回结果
2. 直接通过命名信息执行SQL返回结果
   	
   	

####  映射器

#####  映射器的作用

1. 定义参数类型
2. 描述缓存
3. 描述SQL语句
4. 定义查询结果和POJO的映射关系

#####  xml文件配置方式，实现Mapper

 定义java 接口	

```java
public interface RoleMapper{
	public Role getRole(Long id);
}
```

##### 映射xml文件 

```xml
	<mapper namespace="com.xx.xx.mapper.RoleMapper">
		<select id="getRole" parameterType="long" resuleType="role">
			select * from t_role where id=#{id}
		</select>
	</mapper>
```



#####使用SqlSession 获取Mapper

```
RoleMapper roleMapper = sqlSession.getMapper(RoleMapper.class);
Role role = roleMapper.getRole(1L);	
```



